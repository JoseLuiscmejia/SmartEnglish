<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Magic School Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Roboto:wght@400;700&display=swap');

        :root {
            --bg-body: #80deea; /* Color cian suave */
            --primary: #00c853; 
            --secondary: #ff6d00;
            --accent: #6200ea;
            --card: #ffffff;
            --font: 'Fredoka', sans-serif;
            --radius: 20px;
        }

        body {
            font-family: var(--font);
            background: var(--bg-body);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* CONTENEDOR PRINCIPAL TIPO APP */
        .app-shell {
            width: 95%; max-width: 420px; height: 95vh;
            background: var(--card); border-radius: var(--radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex; flex-direction: column;
            overflow: hidden; border: 4px solid white;
            position: relative;
        }

        /* PANTALLAS (VISTAS) */
        .screen {
            flex: 1; display: none; flex-direction: column;
            padding: 15px; overflow-y: auto; gap: 15px;
            animation: fadeIn 0.3s ease;
        }
        .screen.active { display: flex; }

        @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }

        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; border-bottom: 2px dashed #eee; }
        .logo { font-size: 1.5rem; color: var(--accent); margin: 0; }
        .stats { display: flex; gap: 10px; }
        .pill { background: #FFD700; padding: 5px 10px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; border: 2px solid #ffca28; color: #e65100; cursor: pointer; }
        .mode-btn { background: #eee; border: none; padding: 5px 10px; border-radius: 15px; font-weight: bold; cursor: pointer; }

        /* --- MEN√ö PRINCIPAL --- */
        .translator-box {
            background: #f1f8e9; padding: 15px; border-radius: 20px; border: 2px solid #c5e1a5;
            display: flex; flex-direction: column; gap: 10px;
        }
        textarea {
            width: 100%; height: 60px; border: none; background: transparent;
            font-size: 1.2rem; resize: none; outline: none; font-family: inherit;
        }
        .btn-traducir {
            background: var(--primary); color: white; border: none; padding: 12px;
            border-radius: 15px; font-size: 1.2rem; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 0 #009624; width: 100%;
        }
        .btn-traducir:active { transform: translateY(4px); box-shadow: none; }

        .main-menu-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; flex: 1;
        }
        .menu-card {
            background: white; border: 3px solid #eee; border-radius: 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s; padding: 15px; text-align: center;
            box-shadow: 0 5px 0 #e0e0e0;
        }
        .menu-card:active { transform: translateY(5px); box-shadow: none; }
        .menu-icon { font-size: 3rem; margin-bottom: 5px; }
        .menu-title { font-size: 1.1rem; font-weight: bold; color: #555; }
        
        .card-ingles { border-color: #42a5f5; background: #e3f2fd; }
        .card-games { border-color: #ffca28; background: #fff8e1; }
        .card-cross { border-color: #ef5350; background: #ffebee; }
        .card-quiz { border-color: #ab47bc; background: #f3e5f5; }

        /* --- BOT√ìN VOLVER --- */
        .btn-back {
            background: #b0bec5; border: none; padding: 8px 20px; border-radius: 20px;
            font-weight: bold; color: white; align-self: flex-start; cursor: pointer;
            margin-bottom: 10px; display: flex; align-items: center; gap: 5px;
        }

        /* --- SECCI√ìN INGL√âS (ETAPAS) --- */
        .stage-path { display: flex; flex-direction: column; align-items: center; gap: 20px; padding: 20px 0; }
        .stage-node {
            width: 80%; padding: 20px; background: white; border: 3px solid var(--primary);
            border-radius: 20px; text-align: center; position: relative; cursor: pointer;
            box-shadow: 0 5px 0 #a5d6a7; transition: 0.2s;
        }
        .stage-node.locked { filter: grayscale(1); cursor: not-allowed; border-color: #999; box-shadow: none; background: #eee;}
        .stage-title { font-size: 1.4rem; font-weight: bold; color: var(--primary); }
        .stage-desc { font-size: 0.9rem; color: #666; }
        .lock-icon { font-size: 2rem; position: absolute; right: 20px; top: 15px; }
        
        /* Grid de Vocabulario (dentro de etapa) */
        .vocab-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .vocab-item { 
            aspect-ratio: 1; background: white; border-radius: 15px; display: flex; 
            align-items: center; justify-content: center; font-size: 2rem; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; border: 2px solid transparent;
        }
        .vocab-item:active { border-color: var(--secondary); transform: scale(0.9); }

        /* --- SECCI√ìN JUEGOS --- */
        .games-list { display: flex; flex-direction: column; gap: 15px; }
        .game-row { 
            background: white; padding: 15px; border-radius: 20px; display: flex; 
            align-items: center; justify-content: space-between; border: 2px solid #eee;
            cursor: pointer;
        }
        .game-row:hover { border-color: var(--secondary); }

        /* JUEGO: AHORCADO */
        .hangman-box { text-align: center; margin-top: 20px; }
        .hangman-word { font-size: 2rem; letter-spacing: 10px; margin: 20px 0; font-weight: bold; font-family: monospace; }
        .keyboard { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; }
        .key-btn { width: 35px; height: 35px; border-radius: 8px; border: 1px solid #ccc; background: white; font-weight: bold; cursor: pointer; }
        .key-btn:disabled { background: #eee; color: #ccc; }

        /* JUEGO: MEMORIA */
        .memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 20px; }
        .mem-card { 
            aspect-ratio: 1; background: var(--accent); border-radius: 10px; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0;
            transition: 0.3s; transform-style: preserve-3d;
        }
        .mem-card.flipped { background: white; border: 2px solid var(--accent); color: #333; font-size: 1.5rem; }
        .mem-card.matched { background: var(--primary); border-color: var(--primary); opacity: 0.5; }

        /* JUEGO: CRUCIGRAMA (Simple) */
        .crossword-container {
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 2px;
            background: #333; padding: 5px; border-radius: 10px; margin: 20px 0;
        }
        .cw-cell { aspect-ratio: 1; background: #fff; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; font-weight: bold; position: relative;}
        .cw-cell.black { background: #333; border: none; }
        .cw-input { width: 100%; height: 100%; border: none; text-align: center; font-size: 1.2rem; text-transform: uppercase; font-weight: bold; color: var(--primary); padding: 0;}
        .cw-clues { background: #fff3e0; padding: 10px; border-radius: 10px; font-size: 0.9rem; }

        /* MODAL RESULTADO */
        .result-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; background: white;
            padding: 20px; border-radius: 20px 20px 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            transform: translateY(100%); transition: 0.3s; z-index: 100; text-align: center;
        }
        .result-overlay.show { transform: translateY(0); }

        /* UTILIDADES */
        .confetti { position: absolute; pointer-events: none; animation: fall 3s linear forwards; z-index: 200; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }

    </style>
</head>
<body>

<div class="app-shell">
    
    <!-- HEADER COM√öN -->
    <div class="header">
        <h1 class="logo">Magic School</h1>
        <div class="stats">
            <button class="mode-btn" id="modeBtn" onclick="toggleMode()">ü¶Ñ Ni√±os</button>
            <div class="pill">‚≠ê <span id="score">0</span></div>
        </div>
    </div>

    <!-- PANTALLA 1: MENU PRINCIPAL (DASHBOARD) -->
    <div id="screen-home" class="screen active">
        
        <!-- TRADUCTOR SIEMPRE VISIBLE -->
        <div class="translator-box">
            <div style="font-weight:bold; color:#666;">üìù Traductor R√°pido:</div>
            <textarea id="mainInput" placeholder="Escribe aqu√≠ (ej: Hola)"></textarea>
            <button class="btn-traducir" onclick="traducirMain()">TRADUCIR</button>
        </div>

        <!-- GRID DE MEN√ö -->
        <div class="main-menu-grid">
            <div class="menu-card card-ingles" onclick="goScreen('screen-stages')">
                <div class="menu-icon">üìö</div>
                <div class="menu-title">INGL√âS<br>(Etapas)</div>
            </div>
            <div class="menu-card card-cross" onclick="goScreen('screen-crossword')">
                <div class="menu-icon">üß©</div>
                <div class="menu-title">CRUCIGRAMA</div>
            </div>
            <div class="menu-card card-games" onclick="goScreen('screen-games')">
                <div class="menu-icon">üéÆ</div>
                <div class="menu-title">JUEGOS</div>
            </div>
            <div class="menu-card card-quiz" onclick="alert('¬°Pr√≥ximamente m√°s retos!')">
                <div class="menu-icon">‚ôüÔ∏è</div>
                <div class="menu-title">RETO DIARIO</div>
            </div>
        </div>
    </div>

    <!-- PANTALLA 2: ETAPAS DE INGL√âS -->
    <div id="screen-stages" class="screen">
        <button class="btn-back" onclick="goScreen('screen-home')">‚¨Ö Volver</button>
        <h2 style="text-align:center; color:#42a5f5; margin:0;">Mapa de Aprendizaje</h2>
        
        <div class="stage-path">
            <!-- Etapa 1 -->
            <div class="stage-node" onclick="openStage(1)">
                <div class="stage-title">ETAPA 1</div>
                <div class="stage-desc">Colores, N√∫meros y Saludos</div>
                <div style="position:absolute; right:20px; top:20px; font-size:1.5rem;">‚úÖ</div>
            </div>
            <!-- Etapa 2 -->
            <div class="stage-node locked" id="stage2-btn" onclick="openStage(2)">
                <div class="stage-title">ETAPA 2</div>
                <div class="stage-desc">Animales y Frutas</div>
                <div class="lock-icon">üîí</div>
                <div style="font-size:0.8rem; color:red; margin-top:5px;">Necesitas 50 Puntos</div>
            </div>
             <!-- Etapa 3 -->
             <div class="stage-node locked" onclick="alert('Necesitas 100 puntos')">
                <div class="stage-title">ETAPA 3</div>
                <div class="stage-desc">Frases Completas</div>
                <div class="lock-icon">üîí</div>
            </div>
        </div>
    </div>

    <!-- PANTALLA: CONTENIDO DE ETAPA (GRID) -->
    <div id="screen-stage-content" class="screen">
        <button class="btn-back" onclick="goScreen('screen-stages')">‚¨Ö Mapa</button>
        <h2 id="stageTitle" style="text-align:center; margin:0;">...</h2>
        <div id="stageGrid" class="vocab-grid"></div>
    </div>

    <!-- PANTALLA 3: MEN√ö DE JUEGOS -->
    <div id="screen-games" class="screen">
        <button class="btn-back" onclick="goScreen('screen-home')">‚¨Ö Volver</button>
        <h2 style="text-align:center; color:#ffca28; margin:0;">Zona de Juegos</h2>
        
        <div class="games-list">
            <div class="game-row" onclick="playSoccer()">
                <div>
                    <div style="font-weight:bold; font-size:1.2rem;">‚öΩ F√∫tbol Penalties</div>
                    <div style="font-size:0.8rem; color:#666;">Acierta y mete gol</div>
                </div>
                <div style="font-size:2rem;">ü•Ö</div>
            </div>
            <div class="game-row" onclick="playHangman()">
                <div>
                    <div style="font-weight:bold; font-size:1.2rem;">üòµ Ahorcado</div>
                    <div style="font-size:0.8rem; color:#666;">Adivina la palabra</div>
                </div>
                <div style="font-size:2rem;">üî§</div>
            </div>
            <div class="game-row" onclick="playMemory()">
                <div>
                    <div style="font-weight:bold; font-size:1.2rem;">üß† Memoria</div>
                    <div style="font-size:0.8rem; color:#666;">Busca las parejas</div>
                </div>
                <div style="font-size:2rem;">üÉè</div>
            </div>
        </div>
    </div>

    <!-- PANTALLA JUEGO: F√öTBOL (Simplificado) -->
    <div id="screen-soccer" class="screen">
        <button class="btn-back" onclick="goScreen('screen-games')">‚¨Ö Salir</button>
        <div style="background:#4caf50; height:200px; border-radius:10px; position:relative; border:4px solid white;">
            <div style="width:60%; height:60px; border:5px solid white; border-bottom:none; position:absolute; left:20%; top:0;"></div>
            <div id="keeper" style="font-size:3rem; position:absolute; top:30px; left:45%; transition:0.3s;">üß§</div>
            <div id="ball" style="font-size:2.5rem; position:absolute; bottom:10px; left:45%; transition:0.5s;">‚öΩ</div>
        </div>
        <div id="socQ" style="text-align:center; font-weight:bold; font-size:1.2rem; margin:10px 0;">...</div>
        <div id="socOpts" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>
    </div>

    <!-- PANTALLA JUEGO: AHORCADO -->
    <div id="screen-hangman" class="screen">
        <button class="btn-back" onclick="goScreen('screen-games')">‚¨Ö Salir</button>
        <div class="hangman-box">
            <div id="hm-life" style="font-size:3rem;">üòê</div> <!-- Carita cambia -->
            <div style="color:#666; font-weight:bold;">Vidas: <span id="hm-lives">5</span></div>
            <div id="hm-word" class="hangman-word">_ _ _ _</div>
        </div>
        <div id="hm-keys" class="keyboard"></div>
    </div>

    <!-- PANTALLA JUEGO: MEMORIA -->
    <div id="screen-memory" class="screen">
        <button class="btn-back" onclick="goScreen('screen-games')">‚¨Ö Salir</button>
        <div style="text-align:center;">Encuentra los pares</div>
        <div id="mem-grid" class="memory-grid"></div>
    </div>

    <!-- PANTALLA 4: CRUCIGRAMA -->
    <div id="screen-crossword" class="screen">
        <button class="btn-back" onclick="goScreen('screen-home')">‚¨Ö Volver</button>
        <h2 style="text-align:center; color:#ef5350; margin:0;">Mini Crucigrama</h2>
        
        <div class="cw-clues">
            <strong>Horizontales:</strong><br>1. Color de la sangre (3 letras)<br>
            <strong>Verticales:</strong><br>1. Animal que dice Guau (3 letras)<br>2. Opuesto de Noche (3 letras)
        </div>

        <div class="crossword-container">
            <!-- Fila 1 -->
            <div class="cw-cell"><input class="cw-input" maxlength="1" data-ans="R"></div> <!-- R -->
            <div class="cw-cell"><input class="cw-input" maxlength="1" data-ans="E"></div> <!-- E -->
            <div class="cw-cell"><input class="cw-input" maxlength="1" data-ans="D"></div> <!-- D -->
            <div class="cw-cell black"></div>
            <div class="cw-cell black"></div>
            <div class="cw-cell black"></div>
            <!-- Fila 2 -->
            <div class="cw-cell black"></div>
            <div class="cw-cell black"></div>
            <div class="cw-cell"><input class="cw-input" maxlength="1" data-ans="A"></div> <!-- A -->
            <div class="cw-cell black"></div>
            <div class="cw-cell black"></div>
            <div class="cw-cell black"></div>
            <!-- Fila 3 -->
            <div class="cw-cell"><input class="cw-input" maxlength="1" data-ans="D"></div> <!-- D -->
            <div class="cw-cell"><input class="cw-input" maxlength="1" data-ans="O"></div> <!-- O -->
            <div class="cw-cell"><input class="cw-input" maxlength="1" data-ans="Y"></div> <!-- Y -->
            <div class="cw-cell black"></div>
            <div class="cw-cell black"></div>
            <div class="cw-cell black"></div>
        </div>
        <button class="btn-traducir" style="background:#ef5350;" onclick="checkCrossword()">VERIFICAR</button>
    </div>

    <!-- RESULTADO OVERLAY (Para traducci√≥n y feedback) -->
    <div id="resultPanel" class="result-overlay">
        <div style="font-size:0.9rem; color:#888;">TRADUCCI√ìN:</div>
        <div id="resText" style="font-size:1.8rem; font-weight:bold; color:var(--primary); margin:10px 0;">...</div>
        <div id="resSub" style="font-size:1.2rem; color:#333;">...</div>
        <button onclick="cerrarPanel()" style="margin-top:20px; padding:10px 30px; border-radius:20px; border:none; background:#eee; font-weight:bold;">Cerrar</button>
    </div>

</div>

<script>
    // DATOS DE JUEGO
    let points = parseInt(localStorage.getItem('pts')) || 0;
    let isKids = true;
    
    // DATOS DE VOCABULARIO
    const vocab = {
        stage1: [
            {i:'üî¥', w:'Red', e:'Rojo'}, {i:'üîµ', w:'Blue', e:'Azul'}, {i:'1Ô∏è‚É£', w:'One', e:'Uno'}, {i:'2Ô∏è‚É£', w:'Two', e:'Dos'},
            {i:'üëã', w:'Hello', e:'Hola'}, {i:'üö∂', w:'Bye', e:'Adi√≥s'}, {i:'üü°', w:'Yellow', e:'Amarillo'}, {i:'üü¢', w:'Green', e:'Verde'}
        ],
        stage2: [
            {i:'üê∂', w:'Dog', e:'Perro'}, {i:'üê±', w:'Cat', e:'Gato'}, {i:'ü¶Å', w:'Lion', e:'Le√≥n'}, {i:'üçé', w:'Apple', e:'Manzana'},
            {i:'üçå', w:'Banana', e:'Pl√°tano'}, {i:'üêÆ', w:'Cow', e:'Vaca'}, {i:'üçä', w:'Orange', e:'Naranja'}, {i:'üçá', w:'Grape', e:'Uva'}
        ]
    };

    window.onload = () => {
        updatePoints(0);
        checkLocks();
    };

    // NAVEGACI√ìN
    function goScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        checkLocks();
    }

    // PUNTOS Y L√ìGICA
    function updatePoints(n) {
        points += n;
        document.getElementById('score').innerText = points;
        localStorage.setItem('pts', points);
        checkLocks();
    }

    function checkLocks() {
        if(points >= 50) {
            let s2 = document.getElementById('stage2-btn');
            s2.classList.remove('locked');
            s2.querySelector('.lock-icon').innerText = 'üîì'; // Desbloqueado
        }
    }

    function toggleMode() {
        isKids = !isKids;
        document.getElementById('modeBtn').innerText = isKids ? 'ü¶Ñ Ni√±os' : 'üëî Adultos';
        document.body.style.background = isKids ? '#80deea' : '#b0bec5';
    }

    // --- TRADUCTOR MAIN ---
    async function traducirMain() {
        let txt = document.getElementById('mainInput').value;
        if(!txt) return;
        
        // Simulaci√≥n r√°pida para demo (en app real usar API)
        const dict = {"hola":"Hello", "rojo":"Red", "perro":"Dog", "gato":"Cat", "azul":"Blue"};
        let translation = dict[txt.toLowerCase()] || "Translating..."; 
        
        // Si no est√° en mi mini diccionario, uso la API real
        if(translation === "Translating...") {
            try {
                const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(txt)}&langpair=es|en`);
                const data = await res.json();
                translation = data.responseData.translatedText;
            } catch(e) { translation = "Error"; }
        }

        showResult(translation, txt);
    }

    function showResult(en, es) {
        document.getElementById('resText').innerText = en;
        document.getElementById('resSub').innerText = es;
        document.getElementById('resultPanel').classList.add('show');
        speak(en);
    }

    function cerrarPanel() { document.getElementById('resultPanel').classList.remove('show'); }

    function speak(txt) {
        window.speechSynthesis.cancel();
        let u = new SpeechSynthesisUtterance(txt);
        u.lang = 'en-US';
        u.pitch = isKids ? 1.4 : 1.0;
        window.speechSynthesis.speak(u);
    }

    // --- ETAPAS ---
    function openStage(n) {
        if(n === 2 && points < 50) return alert("¬°Consigue 50 puntos para desbloquear!");
        
        let data = vocab['stage'+n];
        let grid = document.getElementById('stageGrid');
        grid.innerHTML = '';
        document.getElementById('stageTitle').innerText = "Etapa " + n;
        
        data.forEach(item => {
            let div = document.createElement('div');
            div.className = 'vocab-item';
            div.innerText = item.i;
            div.onclick = () => { showResult(item.w, item.e); updatePoints(2); };
            grid.appendChild(div);
        });
        goScreen('screen-stage-content');
    }

    // --- JUEGOS ---
    
    // 1. F√öTBOL
    function playSoccer() {
        goScreen('screen-soccer');
        newKick();
    }
    function newKick() {
        document.getElementById('ball').style.bottom = '10px';
        document.getElementById('ball').style.left = '45%';
        document.getElementById('keeper').style.left = '45%';
        
        // Datos simples
        let q = vocab.stage1[Math.floor(Math.random()*vocab.stage1.length)];
        let wrong = vocab.stage1[Math.floor(Math.random()*vocab.stage1.length)];
        while(wrong.w === q.w) wrong = vocab.stage1[Math.floor(Math.random()*vocab.stage1.length)];

        document.getElementById('socQ').innerText = "¬ø" + q.e + "?";
        let btns = [`<button onclick="kick(true)" class="btn-traducir">${q.w}</button>`, `<button onclick="kick(false)" class="btn-traducir" style="background:#ff9800">${wrong.w}</button>`];
        btns.sort(()=>Math.random()-0.5);
        document.getElementById('socOpts').innerHTML = btns.join('');
    }
    function kick(win) {
        let ball = document.getElementById('ball');
        let keeper = document.getElementById('keeper');
        if(win) {
            ball.style.bottom = "150px"; ball.style.left = "20%";
            keeper.style.left = "70%";
            speak("Goal!"); updatePoints(10); confetti();
            setTimeout(newKick, 1500);
        } else {
            keeper.style.left = "45%"; ball.style.bottom = "50px";
            speak("Oh no");
            setTimeout(newKick, 1000);
        }
    }

    // 2. AHORCADO
    let hiddenWord = "";
    let lives = 5;
    const words = ["RED", "BLUE", "CAT", "DOG", "ONE", "TWO", "MOM", "DAD"];
    
    function playHangman() {
        goScreen('screen-hangman');
        lives = 5;
        hiddenWord = words[Math.floor(Math.random()*words.length)];
        renderHangman();
        renderKeys();
    }
    function renderHangman() {
        document.getElementById('hm-lives').innerText = lives;
        let display = hiddenWord.split('').map(l => triedKeys.includes(l) ? l : "_").join(" ");
        document.getElementById('hm-word').innerText = display;
        
        if(!display.includes("_")) { document.getElementById('hm-life').innerText = "üòé"; speak("You Win!"); updatePoints(20); setTimeout(playHangman, 2000); }
        else if(lives <= 0) { document.getElementById('hm-life').innerText = "üòµ"; speak("Game Over"); setTimeout(playHangman, 2000); }
        else { document.getElementById('hm-life').innerText = lives > 2 ? "üòê" : "üòü"; }
    }
    let triedKeys = [];
    function renderKeys() {
        triedKeys = [];
        let k = document.getElementById('hm-keys'); k.innerHTML = "";
        "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split('').forEach(l => {
            let btn = document.createElement('button');
            btn.className = 'key-btn';
            btn.innerText = l;
            btn.onclick = () => { 
                btn.disabled = true; triedKeys.push(l); 
                if(!hiddenWord.includes(l)) lives--; 
                renderHangman(); 
            };
            k.appendChild(btn);
        });
    }

    // 3. MEMORIA
    let cards = [];
    let flipped = [];
    function playMemory() {
        goScreen('screen-memory');
        let icons = ['üê∂','üê±','ü¶Å','üê∏','üêµ','üê∑']; // 6 pares = 12 cartas
        let list = [...icons, ...icons].sort(()=>Math.random()-0.5);
        let grid = document.getElementById('mem-grid');
        grid.innerHTML = '';
        cards = []; flipped = [];
        
        list.forEach((icon, idx) => {
            let c = document.createElement('div');
            c.className = 'mem-card';
            c.dataset.icon = icon;
            c.dataset.idx = idx;
            c.onclick = () => flipCard(c);
            c.innerText = icon; // Hidden by css color until flip
            grid.appendChild(c);
            cards.push(c);
        });
    }
    function flipCard(card) {
        if(flipped.length >= 2 || card.classList.contains('flipped')) return;
        card.classList.add('flipped');
        flipped.push(card);
        if(flipped.length === 2) {
            if(flipped[0].dataset.icon === flipped[1].dataset.icon) {
                setTimeout(() => { 
                    flipped.forEach(c => c.classList.add('matched')); 
                    flipped = []; 
                    updatePoints(5); 
                }, 500);
            } else {
                setTimeout(() => { 
                    flipped.forEach(c => c.classList.remove('flipped')); 
                    flipped = []; 
                }, 1000);
            }
        }
    }

    // --- CRUCIGRAMA ---
    function checkCrossword() {
        let correct = true;
        document.querySelectorAll('.cw-input').forEach(inp => {
            if(inp.value.toUpperCase() !== inp.dataset.ans) {
                inp.style.backgroundColor = "#ffcdd2"; correct = false;
            } else {
                inp.style.backgroundColor = "#c8e6c9";
            }
        });
        if(correct) {
            confetti();
            updatePoints(50);
            speak("Excellent! Puzzle solved");
            setTimeout(() => {
                document.querySelectorAll('.cw-input').forEach(i => {i.value=''; i.style.background='white';});
            }, 3000);
        } else {
            speak("Try again");
        }
    }

    function confetti() {
        for(let i=0; i<20; i++) {
            let d = document.createElement('div');
            d.innerHTML = 'üéâ'; d.className = 'confetti';
            d.style.left = Math.random()*100 + '%';
            d.style.fontSize = (Math.random()*20+10)+'px';
            d.style.animationDuration = (Math.random()*2+1)+'s';
            document.body.appendChild(d);
            setTimeout(()=>d.remove(), 3000);
        }
    }

</script>
</body>
</html>

